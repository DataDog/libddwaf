# Address Reference

This page lists the Application Security Management (ASM) addresses that libddwaf understands. Addresses represent the structured inputs that processors, filters, and rules consume. The canonical rule packs that reference these addresses live in [`appsec-event-rules`](https://github.com/DataDog/appsec-event-rules/blob/main/build/recommended.json).

---

## HTTP Request & Response Addresses

| Address | Type | Description / Notes | Example |
| --- | --- | --- | --- |
| `server.request.body` | Native value (framework-specific) | Parsed HTTP request body as exposed by the framework. See the dedicated `server.request.body` binder documentation for language-specific nuances. | *(varies)* |
| `server.request.body.filenames` | Array | Filenames supplied through RFC-1867 HTML file uploads. Each entry reflects the original client filename. | `["invoice.pdf", "avatar.png"]` |
| `server.request.body.files_field_names` | Array | Form field names associated with uploaded files (RFC-1867). | `["attachment", "photo"]` |
| `server.request.query` | Native value | Framework-parsed query string (can contain duplicate keys). In .NET a query such as `?test&[$slice]` keeps all keys. | `{ "test": "", "[$slice]": "" }` |
| `server.request.headers.no_cookies` | Headers object | Incoming headers with cookie-related fields removed. Header keys must be lowercase. | `{ "x-forwarded-for": "1.2.3.4", "user-agent": "Moustache" }` |
| `server.request.trailers` | Headers object | HTTP trailing headers. | `{ "grpc-status": "0" }` |
| `server.request.uri.raw` | String | Relative URI (path and query, without scheme or authority). | `/path/bla.php?param1=a&param2=b%20c` |
| `server.request.method` | String | HTTP method. | `"GET"` |
| `server.request.path_params` | Native value | Framework-parsed path parameters (e.g. `/foo/:id` yields `{ id: 123 }`). | `{ "id": "42" }` |
| `server.request.cookies` | Cookies map | Cookies parsed by the framework. AppSec obfuscation operates on keys and values as needed. | `{ "password": ["1234"], "foo": ["bar", "baz"] }` |
| `server.response.status` | String | HTTP response status code. | `"404"` |
| `server.response.headers.no_cookies` | Headers object | Outgoing headers without any `Set-Cookie` entries. | `{ "content-type": "application/json" }` |
| `http.client_ip` | String | Client IP determined by the Datadog client IP resolution policy. | `"203.0.113.10"` |

---

## Exploit Prevention Addresses

| Address | Type | Description |
| --- | --- | --- |
| `server.io.fs.file` | String | File paths analysed by local file inclusion (LFI) rules. |
| `server.io.net.url` | String | URLs analysed by server-side request forgery (SSRF) rules. |
| `server.db.statement` | String | SQL statements inspected by SQL injection rules. |
| `server.db.system` | String | SQL dialect associated with `server.db.statement` (see APM span attribute `db.system`). |
| `server.sys.shell.cmd` | String or array (≥ v1.20.1) | Shell commands analysed by command/remote code injection rules. |

---

## User Monitoring Addresses

| Address | Type | Description |
| --- | --- | --- |
| `usr.id` | String | User identifier captured automatically or via the SDK. |
| `usr.session_id` | String | Session identifier associated with the current request or user. |

---

## Business Logic Addresses

| Address | Type | Description |
| --- | --- | --- |
| `server.business_logic.users.login.success` | Null | Event marker indicating a successful login. |
| `server.business_logic.users.login.failure` | Null | Event marker indicating a failed login. |

---

## Virtual & Auxiliary Addresses

| Address | Type | Description |
| --- | --- | --- |
| `waf.context.event` | Null | Internally generated when an event is triggered; used to gate postprocessors. |
| `waf.context.processor` | Map | Flags enabling processor-dependent features (for example schema extraction). | `{ "extract-schema": true }` |

---

## gRPC Server Addresses

| Address | Type | Description / Notes | Occurrences per RPC | Example |
| --- | --- | --- | --- | --- |
| `grpc.server.method` | String | Fully qualified RPC name of the form `/$package.$service/$method`. Must match the APM span tag `rpc.grpc.full_method`. | 1 (all RPC types) | `"/my.package.Greeter/SayHello"` |
| `grpc.server.request.message` | Native value | Parsed inbound message payload. Provide as ephemeral data per message for streaming RPCs. | Unary: 1<br>Client stream: N<br>Server stream: 1<br>Bidirectional: N | `{ "user": { "id": "42" } }` |
| `grpc.server.request.metadata` | Native string kv map | Client request metadata (headers). Keys must be lowercase; binary keys (`*-bin`) should be base64 encoded. | 0 or 1 (all RPC types) | `{ "user-agent": ["grpc-go/1.58.0"] }` |
| `grpc.server.response.message` | Native value | Parsed outbound message payload generated by the server. Provide as ephemeral data per message for streaming RPCs. | Unary: 1<br>Client stream: 1<br>Server stream: N<br>Bidirectional: M | `{ "status": "OK", "score": 0.97 }` |
| `grpc.server.response.metadata.headers` | Native string kv map | Initial response metadata returned before the first message. | 0 or 1 (all RPC types) | `{ "content-type": ["application/grpc+proto"] }` |
| `grpc.server.response.metadata.trailers` | Native string kv map | Trailing response metadata sent after the final message. | 0 or 1 (all RPC types) | `{ "grpc-message": ["permission denied"] }` |
| `grpc.server.response.status` | Number | Canonical gRPC status code (see [grpc/grpc status codes](https://github.com/grpc/grpc/blob/master/doc/statuscodes.md)). | 1 (all RPC types) | `7` |

---

## GraphQL Server Addresses

| Address | Type | Description / Notes | Occurrences per Request | Example |
| --- | --- | --- | --- | --- |
| `graphql.server.all_resolvers` | Array of resolver objects | Full collection of resolver payloads captured after the GraphQL layer executes. Typically mirrors the HTTP body content but structured per resolver. | 1 aggregated payload | `[{"path":["Query","product"],"arguments":{"id":"123"},"value":"..."}, {"path":["Product","reviews"],"arguments":{},"value":[...] }]` |
| `graphql.server.resolver` | Native value | Resolver payload emitted as each resolver executes. Shape is instrumentation-specific and usually matches a single entry inside `graphql.server.all_resolvers`. | Number of resolvers executed | `{ "path": ["Query","product"], "arguments": { "id": "123" }, "value": "..." }` |

GraphQL payloads generally arrive as part of the HTTP request body before the GraphQL-specific addresses are emitted. libddwaf deduplicates matches across addresses, so a single attack surface only triggers one event even if it appears in both `server.request.body` and a GraphQL address. In practice, GraphQL rule matches surface on the HTTP body address.

---

## Types and Conventions

- **Headers object**: Use the framework’s native header representation as long as keys are lowercased (e.g. `X-Forwarded-For` → `x-forwarded-for`).
- **Native string kv map**: Map of lowercase string keys to arrays of strings, as used by gRPC metadata. Binary keys ending with `-bin` must use base64-encoded values.
- **Native value**: A value in the language/framework’s natural representation. The same address may look different across runtimes; the WAF only relies on the logical content (strings, numbers, collections).
- **Resolver object**: Instrumentation-defined GraphQL resolver payload that usually includes resolver path, arguments, and the resolved value. Resolvers supplied individually and within `graphql.server.all_resolvers` must use the same structure.
- **Cookies map**: A map of cookie names to their values as parsed by the HTTP framework. Values may be strings or arrays of strings depending on language support.
- **Sensitive data obfuscation**: Cookie maps and header objects are scanned by the generic AppSec obfuscator. Keys matching sensitive names (for example `Bearer`) will have their values redacted in emitted events.

These conventions ensure libddwaf can evaluate requests consistently across agents and frameworks while still allowing each integration to map its native data structures to the addresses used by Datadog’s managed rules.
